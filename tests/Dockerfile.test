# Agent-Context Test Environment
# Contains minimal dependencies for testing bootstrap, setup, and CLI

FROM ubuntu:24.04

LABEL maintainer="agent-context"
LABEL description="Test environment for agent-context smoke and integration tests"

# Prevent interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=UTC

# Install base packages required by agent-context
RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates \
    curl \
    wget \
    git \
    jq \
    make \
    bash \
    coreutils \
    && rm -rf /var/lib/apt/lists/*

# Set up git config (required for commits in tests)
RUN git config --global user.email "test@agent-context.local" \
    && git config --global user.name "Test User" \
    && git config --global init.defaultBranch main

# Set working directory
WORKDIR /agent-context

# Copy agent-context source
COPY . /agent-context/

# Make scripts executable
RUN chmod +x /agent-context/bootstrap.sh \
    && chmod +x /agent-context/setup.sh \
    && find /agent-context/tools -name "*.sh" -exec chmod +x {} \; \
    && find /agent-context/tests -name "*.sh" -exec chmod +x {} \; 2>/dev/null || true

# Verify basic setup
RUN echo "=== Environment ===" \
    && bash --version | head -1 \
    && git --version \
    && curl --version | head -1

# Default command
CMD ["/bin/bash"]
