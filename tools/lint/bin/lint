#!/bin/bash
# lint - Unified Coding Convention Checker
#
# Usage:
#   lint c .                   # Check C files
#   lint python . -R           # Check Python files recursively
#   lint bash script.sh        # Check specific file
#   lint make . --junit        # Output JUnit XML
#
# Equivalent to lint-c, lint-python, etc.

set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
BOLD='\033[1m'
NC='\033[0m'

print_usage() {
	cat << EOF
${BOLD}Usage:${NC} lint <language> [OPTIONS] [PATH]

${BOLD}Languages:${NC}
  c, cpp        C/C++ files (*.c, *.h, *.cpp, *.hpp)
  python, py    Python files (*.py)
  bash, sh      Bash scripts (*.sh)
  make          Makefiles (Makefile, *.mk)
  yaml          YAML and Dockerfile (*.yaml, *.yml, Dockerfile)

${BOLD}Options:${NC}
  -R, --recursive      Check directories recursively
  --junit              Output JUnit XML format
  -o, --output FILE    Write output to file (with --junit)
  -q, --quiet          Quiet mode (show errors only)
  -h, --help           Show this help

${BOLD}Examples:${NC}
  lint c .                     # Check C files in current directory
  lint python src/ -R          # Check Python files recursively
  lint bash script.sh          # Check single file
  lint yaml . --junit -o r.xml # Output JUnit to file

${BOLD}Alternative:${NC}
  You can also use individual commands:
  lint-c, lint-python, lint-bash, lint-make, lint-yaml
EOF
}

# No arguments
if [[ $# -eq 0 ]]; then
	print_usage
	exit 0
fi

# First argument is language
LANG="$1"
shift

# Map language to command
case "${LANG}" in
	c|cpp|c++)
		exec "${SCRIPT_DIR}/lint-c" "$@"
		;;
	python|py)
		exec "${SCRIPT_DIR}/lint-python" "$@"
		;;
	bash|sh|shell)
		exec "${SCRIPT_DIR}/lint-bash" "$@"
		;;
	make|makefile)
		exec "${SCRIPT_DIR}/lint-make" "$@"
		;;
	yaml|yml|dockerfile|docker)
		exec "${SCRIPT_DIR}/lint-yaml" "$@"
		;;
	-h|--help|help)
		print_usage
		exit 0
		;;
	-*)
		echo -e "${RED}Error: First argument must be a language, not an option${NC}" >&2
		echo "Usage: lint <language> [OPTIONS] [PATH]" >&2
		echo "Run 'lint --help' for more information." >&2
		exit 1
		;;
	*)
		echo -e "${RED}Error: Unknown language '${LANG}'${NC}" >&2
		echo "Supported: c, python, bash, make, yaml" >&2
		echo "Run 'lint --help' for more information." >&2
		exit 1
		;;
esac
